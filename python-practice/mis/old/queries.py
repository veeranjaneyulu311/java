
# veeranjaneyulu

fetchUserType= "SELECT EXISTS(SELECT USER_TYPE FROM PUBLIC.EMPLOYEES_INFO_REF WHERE USER_TYPE='superadmin' AND EMP_ID=%(empId)s)USER_TYPE"
queryToFetchPatientCountOfGroup= "SELECT COUNT (*),PROGX.ORG_ID, ORG_NM FROM PUBLIC.PATIENT_ORGANISATION_XREF PROGX JOIN PUBLIC.ORGANISATION_REF ORG ON ORG.ORG_ID=PROGX.ORG_ID WHERE PROGX.ORG_GRP_ID=%(ORG_GRP_ID)s"
queryToFetchPatientVisitCountOfGroup= "SELECT COUNT (*),PVT.ORG_ID,ORG_NM FROM OPD.PATIENT_VISIT_TRANS PVT JOIN PUBLIC.ORGANISATION_REF ORG ON ORG.ORG_ID=PVT.ORG_ID WHERE PVT.ORG_GRP_ID=%(ORG_GRP_ID)s"

# clinical
queryToFetchOrgWiseTopTenDiseases="SELECT count(trim( diseases_nm)) DISEASES_COUNT,DISEASES_NM FROM OPD.PATIENT_VISIT_DISEASES_TRANS WHERE ORG_ID=%(orgId)s AND ISACTIVE=TRUE"
# queryToFetchTopTenSellingDrugBrandQty
queryToFetchTopTenSellingDrugBrandQtyFirst="SELECT Sum(qty)::INTEGER AS QTY, org_id, drug_brand_nm FROM ( SELECT brand_id, Sum(pos_qty) AS QTY, org_id, drug_brand_nm FROM pharmacy.pharmacy_point_of_sale_detailed_info_trans WHERE org_id = %(orgId)s AND isactive = true"
queryToFetchTopTenSellingDrugBrandQtySecond="SELECT brand_id, Sum(issued_qty) AS QTY, org_id, drug_brand_nm FROM pharmacy.pharmacy_ipd_usage_detailed_info_trans WHERE org_id = %(orgId)s AND isactive = true"
# mis queries for TopTenSellingDrugBrands
queryToFetchTopTenSellingDrugBrandsFirst="SELECT round(Sum(total_amt)) AS total_amt, org_id, drug_brand_nm, batch_no FROM (SELECT Sum(PPOSDIT.total_amt) AS total_amt, PPOSDIT.org_id, PPOSDIT.drug_brand_nm, PPOSDIT.batch_no FROM pharmacy.pharmacy_point_of_sale_detailed_info_trans PPOSDIT WHERE PPOSDIT.org_id =%(orgId)s AND PPOSDIT.isactive = true"
queryToFetchTopTenSellingDrugBrandsSecond="SELECT Sum(PIUDIT.total_amt) AS total_amt, PIUDIT.org_id,PIUDIT.drug_brand_nm, PIUDIT.batch_no FROM pharmacy.pharmacy_ipd_usage_detailed_info_trans PIUDIT WHERE PIUDIT.org_id = %(orgId)s AND PIUDIT.isactive = true AND PIUDIT.isactive = true"
#
queryToFetchDoctorWiseConsultations ="SELECT count(PVT.visit_dt)as consultations, PVT.org_id, concat(EIR.first_nm, ' ', EIR.last_nm) AS DOCTOR_NM FROM opd.patient_visit_trans PVT JOIN PUBLIC.employees_info_ref EIR ON EIR.emp_id = PVT.doctor_id WHERE PVT.org_id =%(orgId)s AND PVT.isactive = true"
#query for near Expire drugs
queryToFetchOrgWiseNearExpireDrugs= "SELECT PHINV.DRUG_BRAND_NM, PHINV.DRUG_TYPE_NM,TO_CHAR(EXPIRE_DATE, 'DD-MM-YYYY') EXPIRE_DT FROM PHARMACY.PHARMACY_ORG_STORE_BRAND_INVENTORY_TRANS PHINV JOIN EQUIPMENT_INFO EI ON EI.DRUG_BRAND_ID = PHINV.DRUG_BRAND_ID WHERE PHINV.ORG_ID =%(orgId)s AND EXPIRE_DATE > CURRENT_DATE AND AVAILABLE_QTY > 0 AND PHINV.ISACTIVE = TRUE"
queryToFetchPharmacyCurrentInventory= "SELECT PI.DRUG_BRAND_NM, PI.DRUG_TYPE_NM, AVAILABLE_QTY FROM PHARMACY.PHARMACY_ORG_STORE_BRAND_INVENTORY_TRANS PI LEFT JOIN PHARMACY.PHARMACY_VENDOR_REF PV ON PI.VENDOR_ID = PV.VENDOR_ID LEFT JOIN EQUIPMENT_INFO EI ON EI.DRUG_BRAND_ID = PI.DRUG_BRAND_ID WHERE PI.ORG_ID = %(orgId)s ORDER BY available_qty"

#queries for patient  count starts
queryToFetchDayWisePatientCount="SELECT COUNT (*),DATE(CREATED_DTTM) DATE FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=:ORG_ID  AND CAST(CREATED_DTTM  AS DATE) BETWEEN :CURRENT_DT :: DATE - INTERVAL '7DAYS' AND :CURRENT_DT GROUP BY DATE(CREATED_DTTM) ORDER BY DATE(CREATED_DTTM)"
queryToFetchMonthWisePatientCount="SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'YYYY-MON') MONTHS,TO_CHAR(CREATED_DTTM, 'YYYY-MM-01') NEXTVALUE,TO_CHAR(CREATED_DTTM, 'MM') MM,TO_CHAR(CREATED_DTTM, 'YYYY') YEARS FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=:ORG_ID AND TO_CHAR(CREATED_DTTM, 'YYYY-MM-DD')::DATE BETWEEN :CURRENT_MONTH::DATE- INTERVAL '1 YEAR'  AND :CURRENT_MONTH::DATE GROUP BY MONTHS,MM,YEARS,NEXTVALUE ORDER BY YEARS,MM"
queryToFetchDayWiseMaleOrFemalePatientCount="SELECT COUNT (*),DATE(POX.CREATED_DTTM) DATE FROM PUBLIC.PATIENT_ORGANISATION_XREF POX JOIN PUBLIC.PATIENT_INFO_REF PIR ON POX.PATIENT_ID=PIR.PATIENT_ID AND PIR.GENDER ILIKE :GENDER WHERE ORG_ID=:ORG_ID  AND CAST(POX.CREATED_DTTM  AS DATE) BETWEEN :CURRENT_DT :: DATE - INTERVAL '7DAYS' AND :CURRENT_DT GROUP BY DATE(POX.CREATED_DTTM) ORDER BY DATE(POX.CREATED_DTTM)"
queryToFetchMonthWiseMaleOrFemalePatientCount="SELECT COUNT (*),TO_CHAR(POX.CREATED_DTTM, 'YYYY-MON') MONTHS FROM PUBLIC.PATIENT_ORGANISATION_XREF POX JOIN PUBLIC.PATIENT_INFO_REF PIR ON POX.PATIENT_ID=PIR.PATIENT_ID AND PIR.GENDER ILIKE :GENDER WHERE ORG_ID=:ORG_ID AND TO_CHAR(POX.CREATED_DTTM, 'YYYY-MM-DD')::DATE BETWEEN :CURRENT_MONTH::DATE- INTERVAL '1 YEAR'  AND :CURRENT_MONTH::DATE GROUP BY MONTHS ORDER BY MONTHS"
queryToFetchWeekWisePatientCount="SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'MON-W') WEEKS FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=:ORG_ID AND TO_CHAR(CREATED_DTTM, 'YYYY-MM-DD')::DATE BETWEEN :CURRENT_MONTH::DATE  AND :CURRENT_MONTH::DATE+ INTERVAL '1 MONTH' GROUP BY WEEKS"
queryToFetchPatientCountOfGroup="SELECT COUNT (*),PROGX.ORG_ID, ORG_NM FROM PUBLIC.PATIENT_ORGANISATION_XREF PROGX JOIN PUBLIC.ORGANISATION_REF ORG ON ORG.ORG_ID=PROGX.ORG_ID WHERE PROGX.ORG_GRP_ID=%(ORG_GRP_ID)s"
queryToFetchPatientCount="SELECT COUNT (*),DATE(CREATED_DTTM) DATE FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=%(ORG_ID)s"
queryToFetchPatientCountForMonth="SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'MON-W') DATE,TO_CHAR(CREATED_DTTM, 'MM') MONT  FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=%(ORG_ID)s"
queryToFetchAllPatientsCount="SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'YYYY-MON') DATE,TO_CHAR(CREATED_DTTM, 'YYYY-MM-01') NEXTVALUE,TO_CHAR(CREATED_DTTM, 'MM') MM, TO_CHAR(CREATED_DTTM, 'YYYY') YEARS FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=%(ORG_ID)s  GROUP BY DATE,MM,YEARS,NEXTVALUE ORDER BY YEARS,MM"

#queries for patient visit count starts
queryToFetchPatientVisitCount="SELECT COUNT (*),DATE(CREATED_DTTM) DATE FROM OPD.PATIENT_VISIT_TRANS WHERE ORG_ID=%(ORG_ID)s"

queryToFetchPatientVisitCountForMonth="SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'MON-W') DATE,TO_CHAR(CREATED_DTTM, 'MM') MONT  FROM OPD.PATIENT_VISIT_TRANS WHERE ORG_ID=%(ORG_ID)s"

queryToFetchAllPatientVisitsCount="SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'YYYY-MON') DATE,TO_CHAR(CREATED_DTTM, 'YYYY-MM-01') NEXTVALUE,TO_CHAR(CREATED_DTTM, 'MM') MM, TO_CHAR(CREATED_DTTM, 'YYYY') YEARS FROM OPD.PATIENT_VISIT_TRANS WHERE ORG_ID=%(ORG_ID)s  GROUP BY DATE,MM,YEARS,NEXTVALUE ORDER BY YEARS,MM"




# PHANI"S QUERIES:

## SQL Query For Calling for Getting Type of User i.e Super Admin or Not
fetchUserType= "SELECT EXISTS(SELECT USER_TYPE FROM PUBLIC.EMPLOYEES_INFO_REF WHERE USER_TYPE='superadmin' AND EMP_ID=%(empId)s)USER_TYPE"
##########################################################################################################################################

##(1) SQL QUERIES For Fetching Organization Group Wise Invoice Counts(TOTAL BILLS)##
fetchOrGgrpInvoiceCountAndOrgDetailsForAll= "SELECT SUM(INVOICE_NO),ORG_ID,ORG_GRP_ID,ORG_NM FROM (SELECT COUNT(INVOICE_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN PUBLIC.ORGANISATION_REF POR ON PBIT.ORG_ID=POR.ORG_ID WHERE PBIT.ORG_GRP_ID=%(orgGrpId)s AND PBIT.CANCEL_REASON ISNULL AND PBIT.CANCEL_DTTM ISNULL GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT JOIN PUBLIC.ORGANISATION_REF POR ON PPSIT.ORG_ID=POR.ORG_ID WHERE PPSIT.ORG_GRP_ID=%(orgGrpId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT JOIN PUBLIC.ORGANISATION_REF POR ON OPSIT.ORG_ID=POR.ORG_ID WHERE OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND OPSIT.ORG_GRP_ID=%(orgGrpId)s GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID) SUBQUERY"
fetchOrGgrpInvoiceCountAndOrgDetailsForToday="SELECT SUM(INVOICE_NO),ORG_ID,ORG_GRP_ID,ORG_NM FROM (SELECT COUNT (INVOICE_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN PUBLIC.ORGANISATION_REF POR ON PBIT.ORG_ID=POR.ORG_ID WHERE PBIT.ORG_GRP_ID=%(orgGrpId)s AND PBIT.CANCEL_REASON ISNULL AND PBIT.CANCEL_DTTM ISNULL AND CAST(PBIT.CREATED_DTTM AS DATE)=CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT JOIN PUBLIC.ORGANISATION_REF POR ON PPSIT.ORG_ID=POR.ORG_ID WHERE PPSIT.ORG_GRP_ID=%(orgGrpId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE)=CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT JOIN PUBLIC.ORGANISATION_REF POR ON OPSIT.ORG_ID=POR.ORG_ID WHERE OPSIT.ORG_GRP_ID=%(orgGrpId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE)=CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID)SUBQUERY"
fetchOrGgrpInvoiceCountAndOrgDetailsForWeek="SELECT SUM(INVOICE_NO),ORG_ID,ORG_GRP_ID,ORG_NM FROM (SELECT COUNT(INVOICE_NO) INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN PUBLIC.ORGANISATION_REF POR ON PBIT.ORG_ID=POR.ORG_ID WHERE PBIT.ORG_GRP_ID=%(orgGrpId)s AND PBIT.CANCEL_REASON ISNULL AND PBIT.CANCEL_DTTM ISNULL AND CAST(PBIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT JOIN PUBLIC.ORGANISATION_REF POR ON PPSIT.ORG_ID=POR.ORG_ID WHERE PPSIT.ORG_GRP_ID=%(orgGrpId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT JOIN PUBLIC.ORGANISATION_REF POR ON OPSIT.ORG_ID=POR.ORG_ID WHERE OPSIT.ORG_GRP_ID=%(orgGrpId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID)SUBQUERY"
fetchOrGgrpInvoiceCountAndOrgDetailsForMonth="SELECT SUM(INVOICE_NO),ORG_ID,ORG_GRP_ID,ORG_NM FROM (SELECT COUNT (INVOICE_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN PUBLIC.ORGANISATION_REF POR ON PBIT.ORG_ID=POR.ORG_ID WHERE PBIT.ORG_GRP_ID=%(orgGrpId)s AND PBIT.CANCEL_REASON ISNULL AND PBIT.CANCEL_DTTM ISNULL AND CAST(PBIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT JOIN PUBLIC.ORGANISATION_REF POR ON PPSIT.ORG_ID=POR.ORG_ID WHERE PPSIT.ORG_GRP_ID=%(orgGrpId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT JOIN PUBLIC.ORGANISATION_REF POR ON OPSIT.ORG_ID=POR.ORG_ID WHERE OPSIT.ORG_GRP_ID=%(orgGrpId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID)SUBQUERY"
fetchOrGgrpInvoiceCountAndOrgDetailsForThreeMonths="SELECT SUM(INVOICE_NO),ORG_ID,ORG_GRP_ID,ORG_NM FROM (SELECT COUNT (INVOICE_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN PUBLIC.ORGANISATION_REF POR ON PBIT.ORG_ID=POR.ORG_ID WHERE PBIT.ORG_GRP_ID=%(orgGrpId)s AND PBIT.CANCEL_REASON ISNULL AND PBIT.CANCEL_DTTM ISNULL AND CAST(PBIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT JOIN PUBLIC.ORGANISATION_REF POR ON PPSIT.ORG_ID=POR.ORG_ID WHERE PPSIT.ORG_GRP_ID=%(orgGrpId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT JOIN PUBLIC.ORGANISATION_REF POR ON OPSIT.ORG_ID=POR.ORG_ID WHERE OPSIT.ORG_GRP_ID=%(orgGrpId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID)SUBQUERY"
fetchOrGgrpInvoiceCountAndOrgDetailsForCustom= "SELECT SUM(INVOICE_NO),ORG_ID,ORG_GRP_ID,ORG_NM FROM (SELECT COUNT (INVOICE_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN PUBLIC.ORGANISATION_REF POR ON PBIT.ORG_ID=POR.ORG_ID WHERE PBIT.ORG_GRP_ID=%(orgGrpId)s AND PBIT.CANCEL_REASON ISNULL AND PBIT.CANCEL_DTTM ISNULL AND CAST(PBIT.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT JOIN PUBLIC.ORGANISATION_REF POR ON PPSIT.ORG_ID=POR.ORG_ID WHERE PPSIT.ORG_GRP_ID=%(orgGrpId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,POR.ORG_ID,POR.ORG_GRP_ID,POR.ORG_NM FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT JOIN PUBLIC.ORGANISATION_REF POR ON OPSIT.ORG_ID=POR.ORG_ID WHERE OPSIT.ORG_GRP_ID=%(orgGrpId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s GROUP BY POR.ORG_GRP_ID,POR.ORG_NM,POR.ORG_ID)SUBQUERY"
#######################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################

##(1(b)) SQL QUERIES FOr Fetching Organization Level Invoices Collections(TOTAL BILLS)##
fetchOrgWiseModuleInvoices= "SELECT COUNT(INVOICE_NO) INVOICE_NO, 'BILLING' AS TYPE, ORG_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBI WHERE ORG_ID=%(orgId)s AND PBI.CANCEL_REASON ISNULL AND PBI.CANCEL_DTTM ISNULL AND CAST(PBI.CREATED_DTTM AS DATE)=CURRENT_DATE GROUP BY ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO, 'PHARMACY' AS TYPE,ORG_ID FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT WHERE ORG_ID=%(orgId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE)=CURRENT_DATE GROUP BY ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,'OPTICAL' AS TYPE,ORG_ID FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT WHERE ORG_ID=%(orgId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE)=CURRENT_DATE GROUP BY ORG_ID"
fetchOrgWiseModuleInvoicesForWeek= "SELECT COUNT(INVOICE_NO) INVOICE_NO, 'BILLING' AS TYPE, ORG_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBI WHERE ORG_ID=%(orgId)s AND PBI.CANCEL_REASON ISNULL AND PBI.CANCEL_DTTM ISNULL AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO, 'PHARMACY' AS TYPE,ORG_ID FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT WHERE ORG_ID=%(orgId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,'OPTICAL' AS TYPE,ORG_ID FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT WHERE ORG_ID=%(orgId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY ORG_ID"
fetchOrgWiseModuleInvoicesForMonth= "SELECT COUNT(INVOICE_NO) INVOICE_NO, 'BILLING' AS TYPE, ORG_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBI WHERE ORG_ID=%(orgId)s AND PBI.CANCEL_REASON ISNULL AND PBI.CANCEL_DTTM ISNULL AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO, 'PHARMACY' AS TYPE,ORG_ID FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT WHERE ORG_ID=%(orgId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,'OPTICAL' AS TYPE,ORG_ID FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT WHERE ORG_ID=%(orgId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY ORG_ID"
fetchOrgWiseModuleInvoicesForThree="SELECT COUNT(INVOICE_NO) INVOICE_NO, 'BILLING' AS TYPE, ORG_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBI WHERE ORG_ID=%(orgId)s AND PBI.CANCEL_REASON ISNULL AND PBI.CANCEL_DTTM ISNULL AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO, 'PHARMACY' AS TYPE,ORG_ID FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT WHERE ORG_ID=%(orgId)s  AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,'OPTICAL' AS TYPE,ORG_ID FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT WHERE ORG_ID=%(orgId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY ORG_ID"
fetchOrgWiseModuleInvoicesForCustom= "SELECT COUNT(INVOICE_NO) INVOICE_NO, 'BILLING' AS TYPE, ORG_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBI WHERE ORG_ID=%(orgId)s AND PBI.CANCEL_REASON ISNULL AND PBI.CANCEL_DTTM ISNULL  AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN %(startDate)s AND %(endDate)s GROUP BY ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO, 'PHARMACY' AS TYPE,ORG_ID FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT WHERE ORG_ID=%(orgId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL AND CAST(PPSIT.CREATED_DTTM AS DATE) BETWEEN %(startDate)s AND %(endDate)s GROUP BY ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO,'OPTICAL' AS TYPE,ORG_ID FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT WHERE ORG_ID=%(orgId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL AND CAST(OPSIT.CREATED_DTTM AS DATE) BETWEEN %(startDate)s AND %(endDate)s GROUP BY ORG_ID"
fetchOrgWiseModuleInvoicesForAll="SELECT COUNT(INVOICE_NO) INVOICE_NO, 'BILLING' AS TYPE, ORG_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBI WHERE ORG_ID=%(orgId)s AND PBI.CANCEL_REASON ISNULL AND PBI.CANCEL_DTTM ISNULL GROUP BY ORG_ID UNION SELECT COUNT(PPSIT.PHARMACY_BILL_NO)INVOICE_NO, 'PHARMACY' AS TYPE,ORG_ID FROM PHARMACY.PHARMACY_POINT_OF_SALE_INFO_TRANS PPSIT WHERE ORG_ID=%(orgId)s AND PPSIT.CANCEL_REASON ISNULL AND PPSIT.CANCEL_DTTM ISNULL GROUP BY ORG_ID UNION SELECT COUNT(OPSIT.OPTICAL_BILL_NO)INVOICE_NO, 'OPTICAL' AS TYPE,ORG_ID FROM OPTICAL.OPTICAL_POINT_OF_SALE_INFO_TRANS OPSIT WHERE ORG_ID=%(orgId)s AND OPSIT.CANCEL_REASON ISNULL AND OPSIT.CANCEL_DTTM ISNULL GROUP BY ORG_ID"
#################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################

##(2) SQL Queries For Fetching Organization Group Wise IPD Collections(TOTAL IPD REVENUE AMOUNT)##
fetchOrgGrpWiseIpdCollections= "SELECT POR.ORG_ID,POR.ORG_NM,POR.ORG_GRP_ID,ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' "
#############################################################################################################################################################################################################################################################################################################################################################

##(2(b)) SQL QUERIES For Fetching Organization Wise IPD COllections(IP REVENUE)##
queryTofetchOrgWiseIpdCollections="SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(PBI.CREATED_DTTM,'YYYY-MM-DD')DATE,PBI.ORG_ID,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI  WHERE PBI.ORG_ID=%(orgId)s AND AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' "
fetchOrgWiseIpdCollectionsForMonth= "SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(PBI.CREATED_DTTM,'MON-W')DATE,PBI.ORG_ID,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI  WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY DATE,PBI.ORG_ID ORDER BY DATE "
fetchOrgWiseIpdCollectionsForThree="SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(PBI.CREATED_DTTM,'MON')DATE,TO_CHAR(PBI.CREATED_DTTM,'YYYY-MM')YEAR_MM,TO_CHAR((CURRENT_DATE -INTERVAL '3MONTH'),'YYYY-MM-DD')START_DATE,PBI.ORG_ID,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI  WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A'  AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY DATE,YEAR_MM,START_DATE,PBI.ORG_ID ORDER BY YEAR_MM"
fetchOrgWiseIpdCollectionsForAll="SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(PBI.CREATED_DTTM,'YYYY-MON')DATE,TO_CHAR(PBI.CREATED_DTTM,'MM')MM,TO_CHAR(PBI.CREATED_DTTM,'YYYY')YEARS,PBI.ORG_ID,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI  WHERE PBI.ORG_ID=%(orgId)s  AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A'  GROUP BY DATE,MM,YEARS,PBI.ORG_ID ORDER BY YEARS,MM"
##################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################

##(3) SQL QUERIES For Fetching Organization Group Wise OPD Collections(TOTAL OPD REVENUE AMOUNT)##
fetchOrgGrpWiseOPDCollectionForAll= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(SUM(TOTAL_INVOICE_AMT)) AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_STATUS='A' AND PBI.BILL_TYPE='OPD-BILL'"
fetchOrgGrpWiseOPDCollectionForToday= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(SUM(TOTAL_INVOICE_AMT)) AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBI.CREATED_DTTM AS DATE)=CURRENT_DATE AND PBI.BILL_STATUS='A' AND PBI.BILL_TYPE='OPD-BILL'"
fetchOrgGrpWiseOPDCollectionForWeek= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(SUM(TOTAL_INVOICE_AMT)) AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE AND PBI.BILL_STATUS='A' AND PBI.BILL_TYPE='OPD-BILL'"
fetchOrGgrpWiseOPDCollectionForMonth= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(SUM(TOTAL_INVOICE_AMT)) AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE AND PBI.BILL_STATUS='A' AND PBI.BILL_TYPE='OPD-BILL'"
fetchOrGgrpWiseOPDCollectionForThreeMonths= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(SUM(TOTAL_INVOICE_AMT)) AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE AND PBI.BILL_STATUS='A' AND PBI.BILL_TYPE='OPD-BILL'"
fetchOrGgrpWiseOPDCollectionForCustom= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(SUM(TOTAL_INVOICE_AMT)) AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt) AND PBI.BILL_STATUS='A' AND PBI.BILL_TYPE='OPD-BILL'"
################################################################################################################################################################################################################################################################################################################################################################################################################################

##(3(b)) SQL QUERIES For Fetching Organization Wise OPD Collections(OP REVENUE)##
fetchOrgWiseOPDCollectionsForToday= "SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(CREATED_DTTM,'YYYY-MON-DD')DATE,ORG_ID,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS WHERE ORG_ID=%(orgId)s AND BILL_TYPE='OPD-BILL' AND BILL_STATUS='A' AND CAST(CREATED_DTTM AS DATE) =CURRENT_DATE GROUP BY DATE,ORG_ID ORDER BY DATE"
fetchOrgWiseOPDCollectionsForWeek= "SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(CREATED_DTTM,'YYYY-MON-DD')DATE,ORG_ID,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS WHERE ORG_ID=%(orgId)s AND BILL_TYPE='OPD-BILL' AND BILL_STATUS='A' AND CAST(CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY DATE,ORG_ID ORDER BY DATE"
fetchOrgWiseOPDCollectionsForMonth= "SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(CREATED_DTTM,'MON-W')DATE,ORG_ID,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI WHERE ORG_ID=%(orgId)s AND BILL_TYPE='OPD-BILL' AND BILL_STATUS='A' AND CAST(CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY DATE,ORG_ID ORDER BY DATE"
fetchOrgWiseOPDCollectionsForThreeMonths= "SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(CREATED_DTTM,'MON')DATE,TO_CHAR(CREATED_DTTM,'YYYY-MM')YEAR_MM,TO_CHAR((CURRENT_DATE -INTERVAL '3MONTH'),'YYYY-MM-DD')START_DATE,ORG_ID,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS  WHERE ORG_ID=%(orgId)s AND BILL_TYPE='OPD-BILL' AND BILL_STATUS='A' AND CAST(CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY DATE,YEAR_MM,START_DATE,ORG_ID ORDER BY YEAR_MM"
fetchOrgWiseOPDCollectionsForCustom="SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(CREATED_DTTM,'YYYY-MON')DATE,TO_CHAR(CREATED_DTTM,'MM')MM, TO_CHAR(CREATED_DTTM,'YYYY')YEARS,ORG_ID,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS WHERE ORG_ID=%(orgId)s AND BILL_TYPE='OPD-BILL' AND BILL_STATUS='A' AND CAST(CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s GROUP BY DATE,MM,YEARS,ORG_ID ORDER BY YEARS,MM"
fetchOrgWiseOPDCollectionsForAll= "SELECT ROUND(COALESCE(SUM(TOTAL_INVOICE_AMT))) TOTAL_AMT,TO_CHAR(CREATED_DTTM,'YYYY-MON')DATE,TO_CHAR(CREATED_DTTM,'MM')MM, TO_CHAR(CREATED_DTTM,'YYYY')YEARS,ORG_ID,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS WHERE ORG_ID=%(orgId)s AND BILL_TYPE='OPD-BILL' AND BILL_STATUS='A' GROUP BY DATE,MM,YEARS,ORG_ID ORDER BY YEARS,MM"
##############################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################

##(4) SQL QUERIES For Fetching Organization Group Wise IP+OP+Pharmacy Revenue(IP+OP+PHARMACY TOTAL REVENUE)##
fetchOrgGrpWiseIpdAndOpdAndPharmacyCollectionsToday= "SELECT ORG_ID,ORG_NM,ORG_GRP_ID,SUM(TOTAL_AMT)TOTAL_AMT FROM ( SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_TYPE IN('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) = CURRENT_DATE GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) = CURRENT_DATE AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_grp_id=%(orgGrpId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) = CURRENT_DATE group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM ) SUBQUERY"
fetchOrgGrpWiseIpdAndOpdAndPharmacyCollectionsSevenDays= "SELECT ORG_ID,ORG_NM,ORG_GRP_ID,SUM(TOTAL_AMT)TOTAL_AMT FROM ( SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_grp_id=%(orgGrpId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM ) SUBQUERY"
fetchOrgGrpWiseIpdAndOpdAndPharmacyCollectionsOneMonths= "SELECT ORG_ID,ORG_NM,ORG_GRP_ID,SUM(TOTAL_AMT)TOTAL_AMT FROM ( SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_grp_id=%(orgGrpId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM ) SUBQUERY"
fetchOrgGrpWiseIpdAndOpdAndPharmacyCollectionsThreeMonths= " SELECT ORG_ID,ORG_NM,ORG_GRP_ID,SUM(TOTAL_AMT)TOTAL_AMT FROM ( SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_grp_id=%(orgGrpId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM ) SUBQUERY"
fetchOrgGrpWiseIpdAndOpdAndPharmacyCollectionsCustom= "SELECT ORG_ID,ORG_NM,ORG_GRP_ID,SUM(TOTAL_AMT)TOTAL_AMT FROM ( SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_grp_id=%(orgGrpId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM ) SUBQUERY"
fetchOrgGrpWiseIpdAndOpdAndPharmacyCollectionsAll= "SELECT ORG_ID,ORG_NM,ORG_GRP_ID,ROUND(SUM(TOTAL_AMT))TOTAL_AMT  FROM( SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,coalesce(SUM(TOTAL_INVOICE_AMT),0) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,coalesce(SUM(TOTAL_INVOICE_AMT),0) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_GRP_ID=%(orgGrpId)s AND PBI.BILL_STATUS='A' AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,coalesce(sum(pposit.total_bill_amt),0) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_grp_id=%(orgGrpId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM) SUBQUERY"
#####################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################


##(4(b)) SQL QUERIES For Fetching Organization Module Wise IP+OP+PHARMACY Revenue(IP+OP+PHARMACY)##
fetchOrgModuleWiseIpdAndOpdAndPharmacyCollectionsToday="SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) = CURRENT_DATE GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) = CURRENT_DATE AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_id=%(orgId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) = CURRENT_DATE group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM"
fetchOrgModuleWiseIpdAndOpdAndPharmacyCollectionsSevenDays= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_id=%(orgId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM"
fetchOrgModuleWiseIpdAndOpdAndPharmacyCollectionsOneMonths= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_id=%(orgId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM"
fetchOrgModuleWiseIpdAndOpdAndPharmacyCollectionsThreeMonths= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND  PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_id=%(orgId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM"
fetchOrgModuleWiseIpdAndOpdAndPharmacyCollectionsCustom= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_STATUS='A' AND CAST(PBI.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_id=%(orgId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL AND CAST(pposit.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM"
fetchOrgModuleWiseIpdAndOpdAndPharmacyCollectionsAll= "SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'IPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON PBI.ORG_ID=POR.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBI.BILL_STATUS='A' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION SELECT PBI.ORG_ID,POR.ORG_NM,PBI.ORG_GRP_ID,ROUND(coalesce(SUM(TOTAL_INVOICE_AMT),0)) TOTAL_AMT,'OPD' AS TYPE FROM BILLING.PATIENT_BILL_INFO_TRANS PBI JOIN PUBLIC.ORGANISATION_REF POR ON POR.ORG_ID=PBI.ORG_ID WHERE PBI.ORG_ID=%(orgId)s AND PBI.BILL_STATUS='A' AND PBI.BILL_TYPE='OPD-BILL' GROUP BY PBI.ORG_ID,PBI.ORG_GRP_ID,POR.ORG_NM UNION select pposit.org_id,POR.ORG_NM,pposit.org_grp_id,ROUND(coalesce(sum(pposit.total_bill_amt),0)) TOTAL_AMT ,'PHARMACY ' as TYPE from pharmacy.pharmacy_point_of_sale_info_trans pposit JOIN PUBLIC.ORGANISATION_REF POR ON pposit.ORG_ID=POR.ORG_ID where pposit.org_id=%(orgId)s and pposit.isactive='True' AND pposit.cancel_reason ISNULL group by pposit.org_id,pposit.org_grp_id,POR.ORG_NM"
########################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################

##(5) SQL QUERIES For Fetching Branch Wise IP+OP Revenue(IP+OP REVENUE)##
fetchCollectionsOfGroup= "SELECT ROUND(SUM(TOTAL_INVOICE_AMT))SUM,PBT.ORG_ID,ORG_NM FROM BILLING.PATIENT_BILL_INFO_TRANS PBT JOIN PUBLIC.ORGANISATION_REF ORG ON ORG.ORG_ID=PBT.ORG_ID WHERE PBT.ORG_GRP_ID=%(orgGrpId)s AND PBT.BILL_STATUS='A' AND PBT.BILL_TYPE IN('IPD-BILL','IPD-FINAL-BILL','OPD-BILL')"
###############################################################################################################################################################################################################################################################################################################

##(5((b)) SQL QUERIES For Fetching Fetching Branch Collections(IP+OP REVENUE)##
fetchBranchPatientVisitCountCollections= "SELECT ROUND(SUM(TOTAL_INVOICE_AMT))SUM,DATE(CREATED_DTTM) DATE FROM BILLING.PATIENT_BILL_INFO_TRANS WHERE ORG_ID=%(orgId)s AND BILL_STATUS='A' AND BILL_TYPE IN('IPD-BILL','IPD-FINAL-BILL','OPD-BILL')"
fetchBranchPatientVisitCountCollectionsForMonth= "SELECT ROUND(SUM(TOTAL_INVOICE_AMT))SUM,TO_CHAR(CREATED_DTTM, 'MON-W') DATE,TO_CHAR(CREATED_DTTM, 'MM') MONT FROM BILLING.PATIENT_BILL_INFO_TRANS WHERE ORG_ID=%(orgId)s AND BILL_STATUS='A' AND BILL_TYPE IN('IPD-BILL','IPD-FINAL-BILL','OPD-BILL')"
fetchBranchPatientVisitCountCollectionsForAll= "SELECT ROUND(SUM(TOTAL_INVOICE_AMT))SUM,TO_CHAR(CREATED_DTTM, 'YYYY-MON') date,TO_CHAR(CREATED_DTTM, 'YYYY-MM-01') NEXTVALUE,TO_CHAR(CREATED_DTTM, 'MM') MM, TO_CHAR(CREATED_DTTM, 'YYYY') YEARS FROM BILLING.PATIENT_BILL_INFO_TRANS  WHERE ORG_ID=%(orgId)s AND BILL_STATUS='A' AND BILL_TYPE IN('IPD-BILL','IPD-FINAL-BILL','OPD-BILL') GROUP BY date,NEXTVALUE,MM,YEARS ORDER BY YEARS,MM"
#############################################################################################################################################################################################################################################################################################################################################################################################################################################

##(6) SQL QUERIES For Fetching Total Revenue Generated From IPD Beds(REVENUE FOR IP BEDS)##
fetchorgGrpWisetotalRevenueGeneratedForIPDBedsForAll= "SELECT TOTAL_AMT,TOTAL_BEDS,ROUND(TOTAL_AMT/TOTAL_BEDS) AS PER_BED_REVENUE,ORG_NM,INVOICE_SUM.ORG_ID FROM ( SELECT SUM(COALESCE(TOTAL_INVOICE_AMT,0))TOTAL_AMT, PBIT.ORG_ID ,ORF.ORG_NM,ORF.ORG_GRP_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN ORGANISATION_REF ORF ON PBIT.ORG_ID= ORF.ORG_ID WHERE BILL_STATUS='A' AND BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBIT.ORG_GRP_ID=%(orgGrpId)s GROUP BY PBIT.ORG_ID,ORF.ORG_NM,ORF.ORG_GRP_ID) AS INVOICE_SUM, (SELECT SUM(COALESCE(rit.no_of_beds,0)) AS TOTAL_BEDS, RIT.ORG_ID,ORF.ORG_GRP_ID FROM IPD.ROOM_INFO_TRANS RIT JOIN IPD.WARD_INFO_TRANS WIT ON WIT.ORG_ID=RIT.ORG_ID AND RIT.WARD_ID=WIT.WARD_ID AND WARD_TYPE!='OT' JOIN ORGANISATION_REF ORF ON RIT.ORG_ID= ORF.ORG_ID AND ORF.ORG_GRP_ID=%(orgGrpId)s AND WIT.ORG_ID= ORF.ORG_ID AND rit.no_of_beds > 0 GROUP BY RIT.ORG_ID,ORF.ORG_GRP_ID) AS BEDS_SUM WHERE INVOICE_SUM.ORG_ID=BEDS_SUM.ORG_ID AND INVOICE_SUM.ORG_GRP_ID=BEDS_SUM.ORG_GRP_ID"
fetchorgGrpWisetotalRevenueGeneratedForIPDBedsForToday= "SELECT TOTAL_AMT,TOTAL_BEDS,ROUND(TOTAL_AMT/TOTAL_BEDS) AS PER_BED_REVENUE,ORG_NM,INVOICE_SUM.ORG_ID FROM ( SELECT SUM(COALESCE(TOTAL_INVOICE_AMT,0))TOTAL_AMT, PBIT.ORG_ID ,ORF.ORG_NM,ORF.ORG_GRP_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN ORGANISATION_REF ORF ON PBIT.ORG_ID= ORF.ORG_ID WHERE BILL_STATUS='A' AND BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBIT.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBIT.CREATED_DTTM AS DATE)=CURRENT_DATE GROUP BY PBIT.ORG_ID,ORF.ORG_NM,ORF.ORG_GRP_ID) AS INVOICE_SUM, (SELECT SUM(COALESCE(rit.no_of_beds,0)) AS TOTAL_BEDS, RIT.ORG_ID,ORF.ORG_GRP_ID FROM IPD.ROOM_INFO_TRANS RIT JOIN IPD.WARD_INFO_TRANS WIT ON WIT.ORG_ID=RIT.ORG_ID AND RIT.WARD_ID=WIT.WARD_ID AND WARD_TYPE!='OT' JOIN ORGANISATION_REF ORF ON RIT.ORG_ID= ORF.ORG_ID AND ORF.ORG_GRP_ID=:orgGrpId AND CAST(RIT.CREATED_DTTM AS DATE) =CURRENT_DATE AND WIT.ORG_ID= ORF.ORG_ID AND rit.no_of_beds > 0 GROUP BY RIT.ORG_ID,ORF.ORG_GRP_ID) AS BEDS_SUM WHERE INVOICE_SUM.ORG_ID=BEDS_SUM.ORG_ID AND INVOICE_SUM.ORG_GRP_ID=BEDS_SUM.ORG_GRP_ID"
fetchorgGrpWisetotalRevenueGeneratedForIPDBedsForWeek= "SELECT TOTAL_AMT,TOTAL_BEDS,ROUND(TOTAL_AMT/TOTAL_BEDS) AS PER_BED_REVENUE,ORG_NM,INVOICE_SUM.ORG_ID FROM ( SELECT SUM(COALESCE(TOTAL_INVOICE_AMT,0))TOTAL_AMT, PBIT.ORG_ID ,ORF.ORG_NM,ORF.ORG_GRP_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN ORGANISATION_REF ORF ON PBIT.ORG_ID= ORF.ORG_ID WHERE BILL_STATUS='A' AND BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBIT.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE GROUP BY PBIT.ORG_ID,ORF.ORG_NM,ORF.ORG_GRP_ID) AS INVOICE_SUM, (SELECT SUM(COALESCE(rit.no_of_beds,0)) AS TOTAL_BEDS, RIT.ORG_ID,ORF.ORG_GRP_ID FROM IPD.ROOM_INFO_TRANS RIT JOIN IPD.WARD_INFO_TRANS WIT ON WIT.ORG_ID=RIT.ORG_ID AND RIT.WARD_ID=WIT.WARD_ID AND WARD_TYPE!='OT' JOIN ORGANISATION_REF ORF ON RIT.ORG_ID= ORF.ORG_ID AND ORF.ORG_GRP_ID=%(orgGrpId)s AND CAST(RIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE AND WIT.ORG_ID= ORF.ORG_ID AND rit.no_of_beds > 0 GROUP BY RIT.ORG_ID,ORF.ORG_GRP_ID) AS BEDS_SUM WHERE INVOICE_SUM.ORG_ID=BEDS_SUM.ORG_ID AND INVOICE_SUM.ORG_GRP_ID=BEDS_SUM.ORG_GRP_ID"
fetchorgGrpWisetotalRevenueGeneratedForIPDBedsForMonth="SELECT TOTAL_AMT,TOTAL_BEDS,ROUND(TOTAL_AMT/TOTAL_BEDS) AS PER_BED_REVENUE,ORG_NM,INVOICE_SUM.ORG_ID FROM ( SELECT SUM(COALESCE(TOTAL_INVOICE_AMT,0))TOTAL_AMT, PBIT.ORG_ID ,ORF.ORG_NM,ORF.ORG_GRP_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN ORGANISATION_REF ORF ON PBIT.ORG_ID= ORF.ORG_ID WHERE BILL_STATUS='A' AND BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBIT.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE GROUP BY PBIT.ORG_ID,ORF.ORG_NM,ORF.ORG_GRP_ID) AS INVOICE_SUM, (SELECT SUM(COALESCE(rit.no_of_beds,0)) AS TOTAL_BEDS, RIT.ORG_ID,ORF.ORG_GRP_ID FROM IPD.ROOM_INFO_TRANS RIT JOIN IPD.WARD_INFO_TRANS WIT ON WIT.ORG_ID=RIT.ORG_ID AND RIT.WARD_ID=WIT.WARD_ID AND WARD_TYPE!='OT' JOIN ORGANISATION_REF ORF ON RIT.ORG_ID= ORF.ORG_ID AND ORF.ORG_GRP_ID=%(orgGrpId)s AND CAST(RIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE AND WIT.ORG_ID= ORF.ORG_ID AND rit.no_of_beds > 0 GROUP BY RIT.ORG_ID,ORF.ORG_GRP_ID) AS BEDS_SUM WHERE INVOICE_SUM.ORG_ID=BEDS_SUM.ORG_ID AND INVOICE_SUM.ORG_GRP_ID=BEDS_SUM.ORG_GRP_ID"
fetchorgGrpWisetotalRevenueGeneratedForIPDBedsForThreeMonths="SELECT TOTAL_AMT,TOTAL_BEDS,ROUND(TOTAL_AMT/TOTAL_BEDS) AS PER_BED_REVENUE,ORG_NM,INVOICE_SUM.ORG_ID FROM ( SELECT SUM(COALESCE(TOTAL_INVOICE_AMT,0))TOTAL_AMT, PBIT.ORG_ID ,ORF.ORG_NM,ORF.ORG_GRP_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN ORGANISATION_REF ORF ON PBIT.ORG_ID= ORF.ORG_ID WHERE BILL_STATUS='A' AND BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBIT.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE GROUP BY PBIT.ORG_ID,ORF.ORG_NM,ORF.ORG_GRP_ID) AS INVOICE_SUM, (SELECT SUM(COALESCE(rit.no_of_beds,0)) AS TOTAL_BEDS, RIT.ORG_ID,ORF.ORG_GRP_ID FROM IPD.ROOM_INFO_TRANS RIT JOIN IPD.WARD_INFO_TRANS WIT ON WIT.ORG_ID=RIT.ORG_ID AND RIT.WARD_ID=WIT.WARD_ID AND WARD_TYPE!='OT' JOIN ORGANISATION_REF ORF ON RIT.ORG_ID= ORF.ORG_ID AND ORF.ORG_GRP_ID=%(orgGrpId)s AND CAST(RIT.CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE AND WIT.ORG_ID= ORF.ORG_ID AND rit.no_of_beds > 0 GROUP BY RIT.ORG_ID,ORF.ORG_GRP_ID) AS BEDS_SUM WHERE INVOICE_SUM.ORG_ID=BEDS_SUM.ORG_ID AND INVOICE_SUM.ORG_GRP_ID=BEDS_SUM.ORG_GRP_ID"
fetchorgGrpWisetotalRevenueGeneratedForIPDBedsForCustom= "SELECT TOTAL_AMT,TOTAL_BEDS,ROUND(TOTAL_AMT/TOTAL_BEDS) AS PER_BED_REVENUE,ORG_NM,INVOICE_SUM.ORG_ID FROM ( SELECT SUM(COALESCE(TOTAL_INVOICE_AMT,0))TOTAL_AMT, PBIT.ORG_ID ,ORF.ORG_NM,ORF.ORG_GRP_ID FROM BILLING.PATIENT_BILL_INFO_TRANS PBIT JOIN ORGANISATION_REF ORF ON PBIT.ORG_ID= ORF.ORG_ID WHERE BILL_STATUS='A' AND BILL_TYPE IN ('IPD-BILL','IPD-FINAL-BILL') AND PBIT.ORG_GRP_ID=%(orgGrpId)s AND CAST(PBIT.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s GROUP BY PBIT.ORG_ID,ORF.ORG_NM,ORF.ORG_GRP_ID) AS INVOICE_SUM, (SELECT SUM(COALESCE(rit.no_of_beds,0)) AS TOTAL_BEDS, RIT.ORG_ID,ORF.ORG_GRP_ID FROM IPD.ROOM_INFO_TRANS RIT JOIN IPD.WARD_INFO_TRANS WIT ON WIT.ORG_ID=RIT.ORG_ID AND RIT.WARD_ID=WIT.WARD_ID AND WARD_TYPE!='OT' JOIN ORGANISATION_REF ORF ON RIT.ORG_ID= ORF.ORG_ID AND ORF.ORG_GRP_ID=%(orgGrpId)s AND CAST(RIT.CREATED_DTTM AS DATE) BETWEEN %(startDt) AND %(endDt) AND WIT.ORG_ID= ORF.ORG_ID AND rit.no_of_beds > 0 GROUP BY RIT.ORG_ID,ORF.ORG_GRP_ID) AS BEDS_SUM WHERE INVOICE_SUM.ORG_ID=BEDS_SUM.ORG_ID AND INVOICE_SUM.ORG_GRP_ID=BEDS_SUM.ORG_GRP_ID"
######################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################

##(7) SQL QUERIES For Fetching Organization Wise Pharmacy Profits Report(PHARMACY PROFIT DETAILS) ##
fetchOrgWisePharmacyProfits= "SELECT EI.DRUG_BRAND_NM,ROUND(SUM(PURCHASE_COST))PURCHASE_COST,ROUND(SUM(TOTAL_AMT))SALE_AMT, ROUND(SUM(TOTAL_AMT-PURCHASE_COST))PROFIT FROM EQUIPMENT_INFO EI JOIN (SELECT PSID.BRAND_ID,PSID.BATCH_NO,PSID.ORG_ID, PSID.POS_QTY,PSID.TOTAL_AMT ,PSID.COST_PRICE,ROUND((PSID.pos_qty*(PSID.COST_PRICE/PSID.STRIP_KEEPING_UNIT)),2)PURCHASE_COST FROM PHARMACY.PHARMACY_POINT_OF_SALE_DETAILED_INFO_TRANS PSID WHERE PSID.ORG_ID='1260' AND PSID.COST_PRICE IS NOT NULL AND PSID.COST_PRICE > 0 AND PSID.STRIP_KEEPING_UNIT IS NOT NULL AND PSID.STRIP_KEEPING_UNIT > 0 AND PSID.ISACTIVE=TRUE ) AS FOO ON EI.DRUG_BRAND_ID=FOO.BRAND_ID GROUP BY EI.DRUG_BRAND_NM ORDER BY EI.DRUG_BRAND_NM"
fetchOrgWisePhramacyProfitsForToday= "SELECT EI.DRUG_BRAND_NM,ROUND(SUM(PURCHASE_COST))PURCHASE_COST,ROUND(SUM(TOTAL_AMT))SALE_AMT, ROUND(SUM(TOTAL_AMT-PURCHASE_COST))PROFIT FROM EQUIPMENT_INFO EI JOIN (SELECT PSID.BRAND_ID,PSID.BATCH_NO,PSID.ORG_ID, PSID.POS_QTY,PSID.TOTAL_AMT ,PSID.COST_PRICE,ROUND((PSID.pos_qty*(PSID.COST_PRICE/PSID.STRIP_KEEPING_UNIT)),2)PURCHASE_COST FROM PHARMACY.PHARMACY_POINT_OF_SALE_DETAILED_INFO_TRANS PSID WHERE PSID.ORG_ID=%(orgId)s AND PSID.COST_PRICE IS NOT NULL AND PSID.COST_PRICE > 0 AND PSID.STRIP_KEEPING_UNIT IS NOT NULL AND PSID.STRIP_KEEPING_UNIT > 0 AND PSID.ISACTIVE=TRUE AND CAST(CREATED_DTTM AS DATE)=CURRENT_DATE) AS FOO ON EI.DRUG_BRAND_ID=FOO.BRAND_ID"
fetchOrgWisePhramacyProfitsForWeek= "SELECT EI.DRUG_BRAND_NM,ROUND(SUM(PURCHASE_COST))PURCHASE_COST,ROUND(SUM(TOTAL_AMT))SALE_AMT, ROUND(SUM(TOTAL_AMT-PURCHASE_COST))PROFIT FROM EQUIPMENT_INFO EI JOIN (SELECT PSID.BRAND_ID,PSID.BATCH_NO,PSID.ORG_ID, PSID.POS_QTY,PSID.TOTAL_AMT ,PSID.COST_PRICE,ROUND((PSID.pos_qty*(PSID.COST_PRICE/PSID.STRIP_KEEPING_UNIT)),2)PURCHASE_COST FROM PHARMACY.PHARMACY_POINT_OF_SALE_DETAILED_INFO_TRANS PSID WHERE PSID.ORG_ID=%(orgId)s  AND PSID.COST_PRICE IS NOT NULL AND PSID.COST_PRICE > 0 AND PSID.STRIP_KEEPING_UNIT IS NOT NULL AND PSID.STRIP_KEEPING_UNIT > 0 AND PSID.ISACTIVE=TRUE AND CAST(CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '7DAYS' AND CURRENT_DATE) AS FOO ON EI.DRUG_BRAND_ID=FOO.BRAND_ID"
fetchOrgWisePhramacyProfitsForMonth= "SELECT EI.DRUG_BRAND_NM,ROUND(SUM(PURCHASE_COST))PURCHASE_COST,ROUND(SUM(TOTAL_AMT))SALE_AMT, ROUND(SUM(TOTAL_AMT-PURCHASE_COST))PROFIT FROM EQUIPMENT_INFO EI JOIN (SELECT PSID.BRAND_ID,PSID.BATCH_NO,PSID.ORG_ID, PSID.POS_QTY,PSID.TOTAL_AMT ,PSID.COST_PRICE,ROUND((PSID.pos_qty*(PSID.COST_PRICE/PSID.STRIP_KEEPING_UNIT)),2)PURCHASE_COST FROM PHARMACY.PHARMACY_POINT_OF_SALE_DETAILED_INFO_TRANS PSID WHERE PSID.ORG_ID=%(orgId)s AND PSID.COST_PRICE IS NOT NULL AND PSID.COST_PRICE > 0 AND PSID.STRIP_KEEPING_UNIT IS NOT NULL AND PSID.STRIP_KEEPING_UNIT > 0 AND PSID.ISACTIVE=TRUE AND CAST(CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '1MONTH' AND CURRENT_DATE) AS FOO ON EI.DRUG_BRAND_ID=FOO.BRAND_ID"
fetchOrgWisePhramacyProfitsForThreeMonths= "SELECT EI.DRUG_BRAND_NM,ROUND(SUM(PURCHASE_COST))PURCHASE_COST,ROUND(SUM(TOTAL_AMT))SALE_AMT, ROUND(SUM(TOTAL_AMT-PURCHASE_COST))PROFIT FROM EQUIPMENT_INFO EI JOIN (SELECT PSID.BRAND_ID,PSID.BATCH_NO,PSID.ORG_ID, PSID.POS_QTY,PSID.TOTAL_AMT ,PSID.COST_PRICE,ROUND((PSID.pos_qty*(PSID.COST_PRICE/PSID.STRIP_KEEPING_UNIT)),2)PURCHASE_COST FROM PHARMACY.PHARMACY_POINT_OF_SALE_DETAILED_INFO_TRANS PSID WHERE PSID.ORG_ID=%(orgId)s AND PSID.COST_PRICE IS NOT NULL AND PSID.COST_PRICE > 0 AND PSID.STRIP_KEEPING_UNIT IS NOT NULL AND PSID.STRIP_KEEPING_UNIT > 0 AND PSID.ISACTIVE=TRUE AND CAST(CREATED_DTTM AS DATE) BETWEEN CURRENT_DATE -INTERVAL '3MONTH' AND CURRENT_DATE) AS FOO ON EI.DRUG_BRAND_ID=FOO.BRAND_ID"
fetchOrgWisePhramacyProfitsForCustom="SELECT EI.DRUG_BRAND_NM,ROUND(SUM(PURCHASE_COST))PURCHASE_COST,ROUND(SUM(TOTAL_AMT))SALE_AMT, ROUND(SUM(TOTAL_AMT-PURCHASE_COST))PROFIT FROM EQUIPMENT_INFO EI JOIN (SELECT PSID.BRAND_ID,PSID.BATCH_NO,PSID.ORG_ID, PSID.POS_QTY,PSID.TOTAL_AMT ,PSID.COST_PRICE,ROUND((PSID.pos_qty*(PSID.COST_PRICE/PSID.STRIP_KEEPING_UNIT)),2)PURCHASE_COST FROM PHARMACY.PHARMACY_POINT_OF_SALE_DETAILED_INFO_TRANS PSID WHERE PSID.ORG_ID=%(orgId)s AND PSID.COST_PRICE IS NOT NULL AND PSID.COST_PRICE > 0 AND PSID.STRIP_KEEPING_UNIT IS NOT NULL AND PSID.STRIP_KEEPING_UNIT > 0 AND PSID.ISACTIVE=TRUE AND CAST(PSID.CREATED_DTTM AS DATE) BETWEEN %(startDt)s AND %(endDt)s AS FOO ON EI.DRUG_BRAND_ID=FOO.BRAND_ID"
fetchOrgWisePhramacyProfitsForAll= "SELECT EI.DRUG_BRAND_NM,ROUND(SUM(PURCHASE_COST))PURCHASE_COST,ROUND(SUM(TOTAL_AMT))SALE_AMT, ROUND(SUM(TOTAL_AMT-PURCHASE_COST))PROFIT FROM EQUIPMENT_INFO EI JOIN (SELECT PSID.BRAND_ID,PSID.BATCH_NO,PSID.ORG_ID, PSID.POS_QTY,PSID.TOTAL_AMT ,PSID.COST_PRICE,ROUND((PSID.pos_qty*(PSID.COST_PRICE/PSID.STRIP_KEEPING_UNIT)),2)PURCHASE_COST FROM PHARMACY.PHARMACY_POINT_OF_SALE_DETAILED_INFO_TRANS PSID WHERE PSID.ORG_ID=%(orgId)s AND PSID.COST_PRICE IS NOT NULL AND PSID.COST_PRICE > 0 AND PSID.STRIP_KEEPING_UNIT IS NOT NULL AND PSID.STRIP_KEEPING_UNIT > 0 AND PSID.ISACTIVE=TRUE ) AS FOO ON EI.DRUG_BRAND_ID=FOO.BRAND_ID"
################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################

##(8) SQL QUERIES For Fetching Branch Wise Patient Count Details(PATIENT DETAILS)##
fetchPatientCount= "SELECT COUNT (*),DATE(CREATED_DTTM) DATE FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=%(orgId)s"
fetchAllPatientsCount= "SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'YYYY-MON') DATE,TO_CHAR(CREATED_DTTM, 'YYYY-MM-01') NEXTVALUE,TO_CHAR(CREATED_DTTM, 'MM') MM, TO_CHAR(CREATED_DTTM, 'YYYY') YEARS FROM PUBLIC.PATIENT_ORGANISATION_XREF WHERE ORG_ID=%(orgId)s  GROUP BY DATE,MM,YEARS,NEXTVALUE ORDER BY YEARS,MM"
####################################################################################################################################################################################################################################################################################################################

##(9) SQL QUERIES For Fetching Branch Wise Patient Visit Count Details(TOTAL PATIENT VISITS)##
FetchPatientVisitCount= "SELECT COUNT (*),DATE(CREATED_DTTM) DATE FROM OPD.PATIENT_VISIT_TRANS WHERE ORG_ID=%(orgId)s"
fetchAllPatientVisitsCount="SELECT COUNT (*),TO_CHAR(CREATED_DTTM, 'YYYY-MON') DATE,TO_CHAR(CREATED_DTTM, 'YYYY-MM-01') NEXTVALUE,TO_CHAR(CREATED_DTTM, 'MM') MM, TO_CHAR(CREATED_DTTM, 'YYYY') YEARS FROM OPD.PATIENT_VISIT_TRANS WHERE ORG_ID=%(orgId)s  GROUP BY DATE,MM,YEARS,NEXTVALUE ORDER BY YEARS,MM"
###############################################################################################################################################################################################################################################################################################################
















